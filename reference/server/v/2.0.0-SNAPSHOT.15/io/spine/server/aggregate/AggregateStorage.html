<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>AggregateStorage (server 2.0.0-SNAPSHOT.15 API)</title>
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="AggregateStorage (server 2.0.0-SNAPSHOT.15 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/spine/server/aggregate/AggregateRootDirectory.html" title="interface in io.spine.server.aggregate"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/spine/server/aggregate/Apply.html" title="annotation in io.spine.server.aggregate"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/spine/server/aggregate/AggregateStorage.html" target="_top">Frames</a></li>
<li><a href="AggregateStorage.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.spine.server.aggregate</div>
<h2 title="Class AggregateStorage" class="title">Class AggregateStorage&lt;I,S extends io.spine.base.EntityState&lt;I&gt;&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../io/spine/server/storage/AbstractStorage.html" title="class in io.spine.server.storage">io.spine.server.storage.AbstractStorage</a>&lt;I,io.spine.server.aggregate.AggregateHistory&gt;</li>
<li>
<ul class="inheritance">
<li>io.spine.server.aggregate.AggregateStorage&lt;I,S&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>I</code> - the type of IDs of aggregates served by this storage</dd>
<dd><code>S</code> - the type of states of aggregates served by this storage</dd>
</dl>
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../io/spine/server/storage/Storage.html" title="interface in io.spine.server.storage">Storage</a>&lt;I,io.spine.server.aggregate.AggregateHistory&gt;, java.lang.AutoCloseable</dd>
</dl>
<hr>
<br>
<pre>@SPI
public class <span class="typeNameLabel">AggregateStorage&lt;I,S extends io.spine.base.EntityState&lt;I&gt;&gt;</span>
extends <a href="../../../../io/spine/server/storage/AbstractStorage.html" title="class in io.spine.server.storage">AbstractStorage</a>&lt;I,io.spine.server.aggregate.AggregateHistory&gt;</pre>
<div class="block">A storage of aggregate events, snapshots and the most recent aggregate states.

 <p>The instances of this type solve two problems.

 <ol>
     <li>efficient loading of an Aggregate instance from its events;

     <li>storing the latest state of an Aggregate along with its lifecycle flags to allow
     its further querying.
 </ol>

 <h3>Storing Aggregate events</h3>

 <p>Each Aggregate is an event-sourced Entity. To load an Aggregate instance, one plays all
 of the events emitted by it, eventually obtaining the last known state. While the Event Store
 of a Bounded Context, to which some Aggregate belongs, stores all domain events, using it
 for the sake of loading an Aggregate is inefficient in most cases. An overwhelming number of
 the domain events emitted in a Bounded Context and the restrictions applied by an underlying
 storage tools make searching for the events of a particular Aggregate a difficult task, given
 that the events are constantly being appended to the respective Event Store.

 <p>This storage duplicates a portion of events emitted by the Aggregates of a certain type.
 It dramatically narrows down the number of storage records to traverse when loading.
 Additionally, this storage is responsible for storing the intermediate snapshots of Aggregate
 states, incorporating them into an optimized loading routines. The history of an Aggregate
 is being read from the most recent event till its most recent snapshot, which reduces
 the I/O between the underlying storage and application even more and enhances the overall
 system performance.

 <p>In order to store events and snapshots, an intermediate <a href="../../../../io/spine/server/aggregate/AggregateEventStorage.html" title="class in io.spine.server.aggregate"><code>AggregateEventStorage</code></a> is
 created. It persists data as Protobuf message records in its pre-configured
 <a href="../../../../io/spine/server/storage/RecordStorage.html" title="class in io.spine.server.storage"><code>RecordStorage</code></a>.

 <h3>Storing and querying the latest Aggregate states</h3>

 <p>End-users of the framework are able to set the visibility level for each Aggregate state
 by using an <a href="../../../../io/spine/server/entity/EntityVisibility.html" title="class in io.spine.server.entity">(entity).visibility</a> option
 in the Protobuf message corresponding to the Aggregate state. For those Aggregates which are
 visible, the framework routines <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#enableStateQuerying--">enable this storage</a>
 to persist the latest states of Aggregates and allow their further
 <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#readStates-io.spine.client.TargetFilters-io.spine.client.ResponseFormat-">querying</a>. To some extent, it makes this
 storage a part of an application's read-side.

 <p>Similar to storages of other Entity types, <code>AggregateStorage</code> supports querying
 the Aggregate states by the values of their declared entity columns. See <code>io.spine.query</code>
 package docs for more details on the query language.

 <p>However, even if the Aggregate visibility is set to
 <code>NONE</code>, the storage still persists
 the essential bits of Aggregate as-an-Entity. Namely, its identifier, its lifecycle flags
 and version. Such a behavior allows to speed up the execution of calls such
 as <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#index--">obtaining an index</a> of Aggregate identifiers, which otherwise would
 involve major scans of event storage, with <code>DISTINCT</code> group operation applied.

 <p>As long as the Aggregate states are no different in their persistence from other Entities,
 the <code>AggregateStorage</code> uses an intermediate <a href="../../../../io/spine/server/entity/storage/EntityRecordStorage.html" title="class in io.spine.server.entity.storage"><code>EntityRecordStorage</code></a> by delegating
 all state-related operations to it.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier</th>
<th class="colLast" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected </code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#AggregateStorage-io.spine.server.aggregate.AggregateStorage-">AggregateStorage</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="class in io.spine.server.aggregate">AggregateStorage</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">S</a>&gt;&nbsp;delegate)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#AggregateStorage-io.spine.server.ContextSpec-java.lang.Class-io.spine.server.storage.StorageFactory-">AggregateStorage</a></span>(<a href="../../../../io/spine/server/ContextSpec.html" title="class in io.spine.server">ContextSpec</a>&nbsp;context,
                java.lang.Class&lt;? extends <a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">S</a>,?&gt;&gt;&nbsp;aggregateClass,
                <a href="../../../../io/spine/server/storage/StorageFactory.html" title="interface in io.spine.server.storage">StorageFactory</a>&nbsp;factory)</code>
<div class="block">Creates an instance of the storage for a certain aggregate class registered
 in a specific context.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#doTruncate-int-">doTruncate</a></span>(int&nbsp;snapshotIndex)</code>
<div class="block">Drops all records which occur before the N-th snapshot for each entity.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#doTruncate-int-com.google.protobuf.Timestamp-">doTruncate</a></span>(int&nbsp;snapshotIndex,
          com.google.protobuf.Timestamp&nbsp;date)</code>
<div class="block">Drops all records older than <code>date</code> but not newer than the N-th snapshot for each
 entity.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>protected java.util.Iterator&lt;io.spine.server.aggregate.AggregateEventRecord&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-io.spine.core.Version-">historyBackward</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
               int&nbsp;batchSize,
               @Nullable io.spine.core.Version&nbsp;startingFrom)</code>
<div class="block">Acts similar to <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-"><code>historyBackward(id, batchSize)</code></a>,
 but also allows to set the Aggregate version to start the reading from.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>java.util.Iterator&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#index--">index</a></span>()</code>
<div class="block">Returns an iterator over identifiers of Aggregates served by this storage.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>java.util.Optional&lt;io.spine.server.aggregate.AggregateHistory&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#read-I-">read</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id)</code>
<div class="block">Reads a record from the storage by the specified record identifier.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>java.util.Optional&lt;io.spine.server.aggregate.AggregateHistory&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#read-I-int-">read</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
    int&nbsp;batchSize)</code>
<div class="block">Forms and returns an <code>AggregateHistory</code> based on the
 <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-">AggregateStorage.historyBackward(Object, int)</a>  aggregate history}.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>protected java.util.Iterator&lt;io.spine.server.entity.EntityRecord&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#readStates-io.spine.client.ResponseFormat-">readStates</a></span>(io.spine.client.ResponseFormat&nbsp;format)</code>
<div class="block">Reads the aggregate states from the storage and returns the results in the specified format.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>protected java.util.Iterator&lt;io.spine.server.entity.EntityRecord&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#readStates-io.spine.client.TargetFilters-io.spine.client.ResponseFormat-">readStates</a></span>(io.spine.client.TargetFilters&nbsp;filters,
          io.spine.client.ResponseFormat&nbsp;format)</code>
<div class="block">Queries the storage for the Aggregate states according to the passed filters and returns
 the results in the specified response format.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#write-I-io.spine.server.aggregate.AggregateHistory-">write</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
     io.spine.server.aggregate.AggregateHistory&nbsp;events)</code>
<div class="block">Writes events into the storage.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#writeAll-io.spine.server.aggregate.Aggregate-com.google.common.collect.ImmutableList-">writeAll</a></span>(<a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,?,?&gt;&nbsp;aggregate,
        com.google.common.collect.ImmutableList&lt;io.spine.server.aggregate.AggregateHistory&gt;&nbsp;historySegments)</code>&nbsp;</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#writeEventRecord-I-io.spine.server.aggregate.AggregateEventRecord-">writeEventRecord</a></span>(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
                io.spine.server.aggregate.AggregateEventRecord&nbsp;record)</code>
<div class="block">Writes the passed record into the storage.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/aggregate/AggregateStorage.html#writeState-io.spine.server.aggregate.Aggregate-">writeState</a></span>(<a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,?,?&gt;&nbsp;aggregate)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.io.spine.server.storage.AbstractStorage">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;io.spine.server.storage.<a href="../../../../io/spine/server/storage/AbstractStorage.html" title="class in io.spine.server.storage">AbstractStorage</a></h3>
<code><a href="../../../../io/spine/server/storage/AbstractStorage.html#checkNotClosed--">checkNotClosed</a>, <a href="../../../../io/spine/server/storage/AbstractStorage.html#checkNotClosed-java.lang.String-">checkNotClosed</a>, <a href="../../../../io/spine/server/storage/AbstractStorage.html#close--">close</a>, <a href="../../../../io/spine/server/storage/AbstractStorage.html#isClosed--">isClosed</a>, <a href="../../../../io/spine/server/storage/AbstractStorage.html#isMultitenant--">isMultitenant</a>, <a href="../../../../io/spine/server/storage/AbstractStorage.html#isOpen--">isOpen</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="AggregateStorage-io.spine.server.ContextSpec-java.lang.Class-io.spine.server.storage.StorageFactory-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>AggregateStorage</h4>
<pre>public&nbsp;AggregateStorage(<a href="../../../../io/spine/server/ContextSpec.html" title="class in io.spine.server">ContextSpec</a>&nbsp;context,
                        java.lang.Class&lt;? extends <a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">S</a>,?&gt;&gt;&nbsp;aggregateClass,
                        <a href="../../../../io/spine/server/storage/StorageFactory.html" title="interface in io.spine.server.storage">StorageFactory</a>&nbsp;factory)</pre>
<div class="block">Creates an instance of the storage for a certain aggregate class registered
 in a specific context.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>context</code> - the specification of the context within which this storage is being created</dd>
<dd><code>aggregateClass</code> - the class of stored aggregates</dd>
<dd><code>factory</code> - a storage factory to create the underlying storages for event/snapshot records
         and aggregate states</dd>
</dl>
</li>
</ul>
<a name="AggregateStorage-io.spine.server.aggregate.AggregateStorage-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>AggregateStorage</h4>
<pre>protected&nbsp;AggregateStorage(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="class in io.spine.server.aggregate">AggregateStorage</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">S</a>&gt;&nbsp;delegate)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="index--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>index</h4>
<pre>public&nbsp;java.util.Iterator&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&gt;&nbsp;index()</pre>
<div class="block">Returns an iterator over identifiers of Aggregates served by this storage.

 <p>The results include IDs corresponding only to those Aggregate instances which were
 <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#writeState-io.spine.server.aggregate.Aggregate-">explicitly written</a> to this storage. The Aggregate
 identifiers which are included into the persisted events are not taken into account
 by this method due to a performance considerations, as too many event records
 must be scanned and de-duplicated for this.</div>
</li>
</ul>
<a name="read-java.lang.Object-int-">
<!--   -->
</a><a name="read-I-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>read</h4>
<pre>public&nbsp;java.util.Optional&lt;io.spine.server.aggregate.AggregateHistory&gt;&nbsp;read(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
                                                                           int&nbsp;batchSize)</pre>
<div class="block">Forms and returns an <code>AggregateHistory</code> based on the
 <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-">AggregateStorage.historyBackward(Object, int)</a>  aggregate history}.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>id</code> - the identifier of the aggregate for which to return the history</dd>
<dd><code>batchSize</code> - the maximum number of the events to read</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the record instance or <code>Optional.empty()</code> if the
         <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-">aggregate history</a> is empty</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.IllegalStateException</code> - if the storage was closed before</dd>
</dl>
</li>
</ul>
<a name="read-java.lang.Object-">
<!--   -->
</a><a name="read-I-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>read</h4>
<pre>public&nbsp;java.util.Optional&lt;io.spine.server.aggregate.AggregateHistory&gt;&nbsp;read(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id)</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="../../../../io/spine/server/storage/Storage.html#read-I-">Storage</a></code></span></div>
<div class="block">Reads a record from the storage by the specified record identifier.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>id</code> - the identifier of the record to read</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a record instance
         or <code>Optional.empty()</code> if there is no record matching this request</dd>
</dl>
</li>
</ul>
<a name="write-java.lang.Object-io.spine.server.aggregate.AggregateHistory-">
<!--   -->
</a><a name="write-I-io.spine.server.aggregate.AggregateHistory-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>write</h4>
<pre>public&nbsp;void&nbsp;write(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
                  io.spine.server.aggregate.AggregateHistory&nbsp;events)</pre>
<div class="block">Writes events into the storage.

 <p><b>NOTE</b>: This method does not rewrite any events, just appends them. Many events
 can be associated with a single aggregate ID.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>id</code> - the ID for the record</dd>
<dd><code>events</code> - non-empty piece of <code>AggregateHistory</code> to store</dd>
</dl>
</li>
</ul>
<a name="writeEventRecord-java.lang.Object-io.spine.server.aggregate.AggregateEventRecord-">
<!--   -->
</a><a name="writeEventRecord-I-io.spine.server.aggregate.AggregateEventRecord-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeEventRecord</h4>
<pre>protected&nbsp;void&nbsp;writeEventRecord(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
                                io.spine.server.aggregate.AggregateEventRecord&nbsp;record)</pre>
<div class="block">Writes the passed record into the storage.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>id</code> - the aggregate ID</dd>
<dd><code>record</code> - the record to write</dd>
</dl>
</li>
</ul>
<a name="readStates-io.spine.client.TargetFilters-io.spine.client.ResponseFormat-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readStates</h4>
<pre>protected&nbsp;java.util.Iterator&lt;io.spine.server.entity.EntityRecord&gt;&nbsp;readStates(io.spine.client.TargetFilters&nbsp;filters,
                                                                             io.spine.client.ResponseFormat&nbsp;format)</pre>
<div class="block">Queries the storage for the Aggregate states according to the passed filters and returns
 the results in the specified response format.

 <p>The results of this call are eventually consistent with the latest states of aggregates,
 as instances are <em>not</em> restored from their events for querying.
 Instead, this method works on top of the storage of the latest known aggregate states,
 for better performance. In a distributed environment, the records in this storage may be
 outdated, as new events may have been emitted by an aggregate instance on other server nodes.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>filters</code> - the filters to use when querying the aggregate states</dd>
<dd><code>format</code> - the format of the response</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an iterator over the matching <code>EntityRecord</code>s</dd>
</dl>
</li>
</ul>
<a name="readStates-io.spine.client.ResponseFormat-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>readStates</h4>
<pre>protected&nbsp;java.util.Iterator&lt;io.spine.server.entity.EntityRecord&gt;&nbsp;readStates(io.spine.client.ResponseFormat&nbsp;format)</pre>
<div class="block">Reads the aggregate states from the storage and returns the results in the specified format.

 <p>This method performs no filtering. Other than that, it works in the same manner
 as <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#readStates-io.spine.client.TargetFilters-io.spine.client.ResponseFormat-"><code>readStates(filters, format)</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>format</code> - the format of the response</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an iterator over the records</dd>
</dl>
</li>
</ul>
<a name="writeState-io.spine.server.aggregate.Aggregate-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeState</h4>
<pre>protected&nbsp;void&nbsp;writeState(<a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,?,?&gt;&nbsp;aggregate)</pre>
</li>
</ul>
<a name="writeAll-io.spine.server.aggregate.Aggregate-com.google.common.collect.ImmutableList-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>writeAll</h4>
<pre>protected&nbsp;void&nbsp;writeAll(<a href="../../../../io/spine/server/aggregate/Aggregate.html" title="class in io.spine.server.aggregate">Aggregate</a>&lt;<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>,?,?&gt;&nbsp;aggregate,
                        com.google.common.collect.ImmutableList&lt;io.spine.server.aggregate.AggregateHistory&gt;&nbsp;historySegments)</pre>
</li>
</ul>
<a name="historyBackward-java.lang.Object-int-io.spine.core.Version-">
<!--   -->
</a><a name="historyBackward-I-int-io.spine.core.Version-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>historyBackward</h4>
<pre>protected&nbsp;java.util.Iterator&lt;io.spine.server.aggregate.AggregateEventRecord&gt;&nbsp;historyBackward(<a href="../../../../io/spine/server/aggregate/AggregateStorage.html" title="type parameter in AggregateStorage">I</a>&nbsp;id,
                                                                                             int&nbsp;batchSize,
                                                                                             @Nullable io.spine.core.Version&nbsp;startingFrom)</pre>
<div class="block">Acts similar to <a href="../../../../io/spine/server/aggregate/AggregateStorage.html#historyBackward-I-int-"><code>historyBackward(id, batchSize)</code></a>,
 but also allows to set the Aggregate version to start the reading from.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>id</code> - identifier of the Aggregate</dd>
<dd><code>batchSize</code> - the maximum number of the history records to read</dd>
<dd><code>startingFrom</code> - an Aggregate version from which the historical events are read</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a new instance of iterator over the results</dd>
</dl>
</li>
</ul>
<a name="doTruncate-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doTruncate</h4>
<pre>protected&nbsp;void&nbsp;doTruncate(int&nbsp;snapshotIndex)</pre>
<div class="block">Drops all records which occur before the N-th snapshot for each entity.</div>
</li>
</ul>
<a name="doTruncate-int-com.google.protobuf.Timestamp-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>doTruncate</h4>
<pre>protected&nbsp;void&nbsp;doTruncate(int&nbsp;snapshotIndex,
                          com.google.protobuf.Timestamp&nbsp;date)</pre>
<div class="block">Drops all records older than <code>date</code> but not newer than the N-th snapshot for each
 entity.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/spine/server/aggregate/AggregateRootDirectory.html" title="interface in io.spine.server.aggregate"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/spine/server/aggregate/Apply.html" title="annotation in io.spine.server.aggregate"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/spine/server/aggregate/AggregateStorage.html" target="_top">Frames</a></li>
<li><a href="AggregateStorage.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
